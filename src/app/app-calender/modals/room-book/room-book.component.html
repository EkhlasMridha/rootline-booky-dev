<div class="full-width" fxLayout="column">
  <div fxLayoutAlign="center center" class="form-header">
    <span>Create a booking</span>
  </div>
  <div class="form-content">
    <form
      [formGroup]="bookingForm"
      (ngSubmit)="onSubmit()"
      class="full-width"
      fxLayoutGap="10px"
      fxLayout="column"
    >
    <div fxLayout="column">
      <div class="full-width" fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="5px">
        <span class="search-criteria">Search by:</span>
        <span class="search-criteria primary-color cursor-pointer"
          [matMenuTriggerFor]="menu">{{selectedCriteria.value}}</span>
        <mat-menu #menu="matMenu" xPosition="before">
          <button mat-menu-item *ngFor="let criteria of searchCriterias"
            (click)="setCriteria(criteria)">{{criteria.value}}</button>
        </mat-menu>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="10px">
        <div fxLayout="row" fxLayoutGap="5px">
          <button
            mat-icon-button
            type="button"
            fxLayoutAlign="center center"
            (click)="createCustomer()"
          >
            <mat-icon svgIcon="user" style="transform: scale(0.8)"></mat-icon>
          </button>
        </div>
        <mat-form-field class="full-width" color="accent">
          <mat-label>Select Customer</mat-label>
          <mat-select #select formControlName="customerId" required>
            <mat-select-trigger
              *ngIf="selectedCustomer && selectedCustomer.value"
              >{{ selectedCustomer.value.name_2 }}
              {{ selectedCustomer.value.name_1 }}</mat-select-trigger
            >
            <mat-option>
              <ngx-mat-select-search
                [formControl]="customerListFilterCtrl"
                [searching]="searching"
                placeholderLabel="Search by {{selectedCriteria.value}}"
                noEntriesFoundLabel="No customer found"
              ></ngx-mat-select-search>
            </mat-option>
            <mat-option
              *ngFor="let customer of customerList$ | async"
              [value]="customer"
            >
              <div class="name" fxLayout="column">
                <span class="name-tag"
                  >{{ customer.name_2 }} {{ customer.name_1 }}</span
                >
                <div fxLayout="row" fxLayoutGap="10px">
                  <span class="details" *ngIf="customer.phone_mobile!=''">Phone: {{ customer.phone_mobile }}</span>
                  <span class="details" *ngIf="customer.mail!=''">Email: {{ customer.mail }}</span>
                </div>
              </div>
            </mat-option>
          </mat-select>
          <mat-error>{{ errorObservers$.customerId | async }}</mat-error>
        </mat-form-field>
      </div>
    </div>

      <div>
        <mat-form-field color="accent" class="full-width">
          <mat-label>Select end date</mat-label>
          <input
            matInput
            formControlName="toDate"
            [matDatepicker]="picker1"
            [matDatepickerFilter]="bookedDates"
            required
          />
          <mat-datepicker-toggle
            matPrefix
            [for]="picker1"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker1 [startAt]="startDate"></mat-datepicker>
          <mat-error>{{ errorObservers$.toDate | async }}</mat-error>
        </mat-form-field>
      </div>
      <div
        fxLayout="column"
        fxLayoutAlign="start start"
      >
      <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px">
        <div fxLayout="column">
          <div fxLayout="row" fxLayoutGap="10px">
            <mat-form-field color="accent" required>
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" placeholder="guest name">
            </mat-form-field>
            <mat-form-field color="accent" style="max-width: 80px;" required>
              <mat-label>Age</mat-label>
              <input matInput formControlName="age" type="number" placeholder="age">
            </mat-form-field>
          </div>
          </div>
          <button mat-stroked-button color="accent" fxLayout="row" type="button" (click)="addGuest()">
            <mat-icon style="height: 16px;width: 16px;font-size: 16px;">add</mat-icon><span>Guest</span>
        </button>
      </div>
      <div fxLayout="column" fxLayoutGap="10px">
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px" *ngFor="let guest of guestList">
      
          <mat-icon style="height: 14px;width: 14px;font-size: 14px;color: #806e6e;" class="cursor-pointer"
            (click)="removeGuest(guest)">
            clear
          </mat-icon>
          <div fxLayout="row" fxLayoutGap="15px">
            <span class="sub-text">{{guest.name}}</span>
            <span class="sub-text">{{guest.age}}</span>
          </div>
        </div>
      </div>
      </div>
      <div>
        <mat-form-field class="full-width" color="accent">
          <mat-label>CHF/Night</mat-label>
          <input
            matInput
            formControlName="chf"
            placeholder="CHF/Night"
            type="number"
            min="0"
            required
          />
          <mat-error>{{ errorObservers$.chf | async }}</mat-error>
        </mat-form-field>
      </div>
      <span class="form-errors">{{
        bookingForm.errors ? errorTypeGenerator("error", "bookingForm") : ""
      }}</span>
      <div
        class="full-width"
        fxLayout="row"
        fxLayoutGap="15px"
        fxLayoutAlign="end end"
      >
        <button mat-stroked-button type="button" (click)="close()">
          Cancel
        </button>
        <button mat-raised-button color="accent" type="submit">Save</button>
      </div>
    </form>
  </div>
</div>
